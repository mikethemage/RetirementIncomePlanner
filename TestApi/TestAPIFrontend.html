<!DOCTYPE html>
<html>

<head>
    <title>API Form Submission Test</title>
</head>

<body>
    <form id="myForm">
        <label for="operand1">Operand 1:</label>
        <input type="number" id="operand1" name="operand1" required><br><br>

        <p>+</p><br/>

        <label for="operand2">Operand 2:</label>
        <input type="number" id="operand2" name="operand2" required><br><br>

        <input type="submit" id="Submit" value="Calculate Result"><br><br>
    </form>

    <label for="resultValue">Result:</label>
    <input readonly type="number" id="resultValue" name="resultValue"><br><br>

    <script>
        const APIendpoint = 'https://testapi20230512145105.azurewebsites.net/api/Addition'; //'https://localhost:7190/api/Addition';

        const form = document.getElementById('myForm');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const json = prepareFormData(form);

            try {
                const response = await fetch(APIendpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: json
                });

                if (response.ok) {
                    // Process the result as needed
                    const result = await response.json();

                    console.log(result);

                    const resultValue = result['result'];

                    // Update the Output element with the image URL
                    const resultElement = document.getElementById('resultValue');
                    resultElement.value = resultValue;

                } else {
                    console.log('Error:', response.status);
                    console.log('Error:', await response.json());
                    // Handle the error
                }
            } catch (error) {
                console.log('Error:', error.message);
                // Handle the error
            }
        });



        function prepareFormData(form) {
            const formData = new FormData(form);
            const formObject = {};

            // Iterate through the form data entries
            for (const entry of formData.entries()) {
                const [name, value] = entry;

                // Assign non-client fields directly
                formObject[name] = value;

            }

            

            const json = getPrettyJSON(formObject);
            console.log(json);

            return json;
        }

        function isEmpty(value) {
            if (value === null || value === undefined || value === "") {
                return true;
            }

            if (Array.isArray(value)) {
                return value.every(isEmpty);
            }
            else if (typeof (value) === 'object') {
                return Object.values(value).every(isEmpty);
            }

            return false;
        }


        function replacer(key, value) {
            return isEmpty(value)
                ? undefined
                : value;
        }

        function getPrettyJSON(obj) {
            return JSON.stringify(obj, replacer, 2);
        }


    </script>
</body>

</html>